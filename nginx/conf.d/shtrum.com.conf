# HTTP only vhost for apex domain redirects
# Purpose: Redirect CalDAV/CardDAV well-known lookups from shtrum.com to owa.shtrum.com
# Note: We do not terminate HTTPS for shtrum.com here (no cert). Clients will
# follow HTTP 301 to the HTTPS endpoint on owa.shtrum.com.
server {
    listen 80;
    server_name shtrum.com www.shtrum.com;

    # Letâ€™s Encrypt challenge (in case we later issue a cert for this host)
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # Redirect well-known DAV endpoints explicitly to the owa host
    location = /.well-known/caldav {
        return 301 https://owa.shtrum.com/caldav/;
    }

    location = /.well-known/carddav {
        return 301 https://owa.shtrum.com/carddav/;
    }

    # Fallback: redirect everything else to the owa host
    location / {
        return 301 https://owa.shtrum.com$request_uri;
    }
}


